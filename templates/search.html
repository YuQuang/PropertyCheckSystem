{% extends 'new_Template.html' %}
{% block title %}
<title>Search Data</title>
{% endblock %}

{# 此部分為css #}
{% block style %}
<style>
    [v-cloak]{
        display: none;
    }
</style>
{% endblock %}


{% block content %}
<div id="itemCard">
    {% load static %}
    <!-- 上方功能欄位 -->
    <div v-cloak class="container mx-auto px-2" @scroll="hideContextMenu( $event )">
        {% verbatim %}
        <!-- 排列欄位 -->
        <div class="py-2 justify-between grid md:grid-cols-2 grid-cols-1">
            <div class="p-3">
                <svg class="inline-block mr-3 w-6" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 301.219 301.219" style="enable-background:new 0 0 301.219 301.219;" xml:space="preserve">
                    <path d="M159.365,23.736v-10c0-5.523-4.477-10-10-10H10c-5.523,0-10,4.477-10,10v10c0,5.523,4.477,10,10,10h139.365   C154.888,33.736,159.365,29.259,159.365,23.736z"/>
                    <path d="M130.586,66.736H10c-5.523,0-10,4.477-10,10v10c0,5.523,4.477,10,10,10h120.586c5.523,0,10-4.477,10-10v-10   C140.586,71.213,136.109,66.736,130.586,66.736z"/>
                    <path d="M111.805,129.736H10c-5.523,0-10,4.477-10,10v10c0,5.523,4.477,10,10,10h101.805c5.523,0,10-4.477,10-10v-10   C121.805,134.213,117.328,129.736,111.805,129.736z"/>
                    <path d="M93.025,199.736H10c-5.523,0-10,4.477-10,10v10c0,5.523,4.477,10,10,10h83.025c5.522,0,10-4.477,10-10v-10   C103.025,204.213,98.548,199.736,93.025,199.736z"/>
                    <path d="M74.244,262.736H10c-5.523,0-10,4.477-10,10v10c0,5.523,4.477,10,10,10h64.244c5.522,0,10-4.477,10-10v-10   C84.244,267.213,79.767,262.736,74.244,262.736z"/>
                    <path d="M298.29,216.877l-7.071-7.071c-1.875-1.875-4.419-2.929-7.071-2.929c-2.652,0-5.196,1.054-7.072,2.929l-34.393,34.393   V18.736c0-5.523-4.477-10-10-10h-10c-5.523,0-10,4.477-10,10v225.462l-34.393-34.393c-1.876-1.875-4.419-2.929-7.071-2.929   c-2.652,0-5.196,1.054-7.071,2.929l-7.072,7.071c-3.904,3.905-3.904,10.237,0,14.142l63.536,63.536   c1.953,1.953,4.512,2.929,7.071,2.929c2.559,0,5.119-0.976,7.071-2.929l63.536-63.536   C302.195,227.113,302.195,220.781,298.29,216.877z"/>
                </svg>
                <select @change="sortProperty()" class="rounded border appearance-none border-gray-300 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-200 flex-grow
                             focus:border-indigo-500 text-base pl-3 pr-10" v-model="nowSort">
                    <option value="0">請選擇</option>
                    <option value="1">名稱</option>
                    <option value="3">編號</option>
                    <option value="5">地點</option>
                    <option value="7">取得日期</option>
                    <option value="8">價格</option>
                </select>
            </div>
            <!-- 搜尋欄位 -->
            <div class="p-3 grid grid-cols-4 gap-1">
                <button class="max-w-fit bg-white hover:bg-gray-100 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow" @click="downloadExcel">
                    匯出
                </button>
                <input v-model="searchInput" v-on:keydown.enter="search" class="py-3 px-4 bg-white rounded-lg placeholder-gray-400
                    text-gray-900 appearance-none shadow-md w-full focus:outline-none
                    focus:ring-2 focus:ring-blue-600 col-span-3" placeholder="Search">
            </div>
        </div>
        <!-- 卡片樣本迴圈生成 -->
        <section class="text-gray-600 body-font px-2">
            <div class="container py-5 mx-auto">
                <div class="flex flex-wrap -m-4">
                    <!-- 載入骨架 -->
                    <div class="xl:w-1/4 md:w-1/3 w-1/2 p-6" v-for="n in 12" :class="spinCircleStatus">
                        <div class="h-full border-2 border-gray-200 rounded-lg overflow-hidden bg-white">
                        <div class="lg:h-40 bg-gray-400 md:h-36 w-full object-cover object-center"></div>
                        <div class="p-6">
                            <h2 class="bg-gray-400 animate-pulse h-4 w-1/4 mb-2"></h2>
                            <h1 class="w-1/2 mb-4 h-6 animate-pulse bg-gray-500"></h1>
                            <p class="leading-relaxed mb-3 w-full h-3 animate-pulse bg-gray-400"></p>
                            <p class="leading-relaxed mb-3 w-2/3 h-3 animate-pulse bg-gray-400"></p>
                            <p class="leading-relaxed mb-3 w-1/2 h-3 animate-pulse bg-gray-400"></p>
                            <div class="flex items-center flex-wrap ">
                            <a class="bg-indigo-300 h-4 animate-pulse mt-2 w-32 inline-flex items-center md:mb-2 lg:mb-0"></a>
                            <span class="bg-indigo-300 w-16 mt-2 h-4 animate-pulse mr-3 px-2 inline-flex items-center ml-auto leading-none text-sm pr-5 py-1">
                            </span>
                            </div>
                        </div>
                        </div>
                    </div>
                    <!-- 真正的資料卡片 -->
                    <div v-for="singleData in pagePropertyData" class="xl:w-1/4 md:w-1/3 w-1/2 p-4">
                        <div :class="'rightMenu rounded-xl hover:bg-gray-200 hover:opacity-75 cursor-pointer ' + ((singleData.status == 'a') ? 'bg-gray-100' : 'bg-red-100')"
                            ondragstart='return false' @click="href( singleData )"
                            @contextMenu="contextmenu( $event , singleData );" oncontextmenu="return false;">
                            <img class="h-40 rounded w-full object-cover object-center rounded-t-xl"
                                :src="singleData.image.replace('localhost:8000', 'property.aimmalab.com')" alt="content" loading="lazy">
                            <div class="select-none mt-2 p-4">
                                <h3 class="uppercase tracking-wide text-indigo-500 text-md title-font break-words">{{
                                    singleData.product_name }}</h3>
                                <h2
                                    class="block mt-2 sm:text-md text-lg leading-tight font-medium text-black break-words">
                                    編號: {{ singleData.product_number }}</h2>
                                <h2
                                    class="block mt-1 sm:text-md text-lg leading-tight font-medium text-black break-words">
                                    序號: {{ singleData.number }}</h2>
                                <div class="inline-block sm:text-md w-1/2 break-words">位置: {{ singleData.position }}
                                </div>
                                <div class="inline-block sm:text-md w-1/2 break-words">數量: {{ singleData.quantity }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- 下方頁面選擇欄位 -->
        <div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6 rounded-2xl">
            <div class="flex-1 flex justify-between sm:hidden">
                <div class="relative inline-flex items-center">
                    <a v-if="now_page-1 > 0" @click="reLoad(now_page-1)" class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-md
                         text-gray-700 bg-white hover:text-gray-500">
                        Previous
                    </a>
                </div>
                <div class="relative inline-flex items-center">
                    <select style="appearance: none;-webkit-appearance: none;-moz-appearance: none;-ms-appearance: none;text-align-last: center;"
                            class="w-10 text-center bg-opacity-0" @change="phoneChangePage($event)">
                        <option v-for="n in total_page" :value="n">{{n}}</option>
                    </select>
                </div>
                <a v-if="now_page+1 <= total_page" @click="reLoad(now_page+1)"
                    class="ml-3 relative inline-flex items-center px-4 py-2
                         border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:text-gray-500">
                    Next
                </a>
            </div>
            <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                <div>
                    <p class="text-sm text-gray-700">
                        Showing
                        <span class="font-medium">{{ (now_page-1)*num_one_page+1 }}</span>
                        to
                        <span class="font-medium">{{ propertyData.length > now_page*num_one_page? now_page*num_one_page
                            : propertyData.length }}</span>
                        of
                        <span class="font-medium">{{ propertyData.length }}</span>
                        results
                        <span class="font-medium">{{ total_page }} pages</span>
                    </p>
                </div>
                <div>
                    <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                        <a v-if="now_page-1 > 0" @click="Load(now_page-1, true)" class="relative inline-flex items-center px-2 py-2 rounded-l-md border
                            border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                            <span class="sr-only">Previous</span>
                            <!-- Heroicon name: solid/chevron-left -->
                            <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                            </svg>
                        </a>

                        <a @click="Load(1, true)" class="cursor-pointer relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm
                            font-medium text-gray-700 hover:bg-gray-50">
                            First
                        </a>
                        
                        <a v-for="i in pagesRange()" @click="Load(i)"
                            class="select-none cursor-pointer hidden md:inline-flex relative
                                items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">
                            {{ i }}
                        </a>
                        <a @click="Load(total_page)" class="cursor-pointer relative inline-flex items-center px-4 py-2 border border-gray-300
                            bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">
                            Last
                        </a>

                        <a v-if="now_page + 1 <= total_page" @click="Load(now_page+1, true)"
                            class="select-none relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                            <span class="sr-only">Next</span>
                            <!-- Heroicon name: solid/chevron-right -->
                            <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                            </svg>
                        </a>
                    </nav>
                </div>
            </div>
        </div>
        {% endverbatim %}
    </div>
    <!-- Alert視窗 -->
    <div v-cloak :class="{'fixed flex justify-center z-30 w-full top-2 transition-opacity duration-500':true, 'opacity-0': !isAlertShow, 'opacity-100': isAlertShow, 'hidden': isAlertHide}">
        <div :class="'text-white px-6 py-4 border-0 rounded relative md:w-auto w-10/12 max-w-lg ' + alertColor">
            {% verbatim %}
            <span class="text-xl inline-block mr-3 align-middle w-6 animate-bounce">
                <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	                 viewBox="0 0 511.999 511.999" style="enable-background:new 0 0 511.999 511.999;" xml:space="preserve">
                    <path style="fill:#F2B844;" d="M403.065,81.145c-5.657,0-11.398-1.187-16.866-3.699c-9.846-4.523-17.342-12.608-21.107-22.767
                        c-3.764-10.159-3.346-21.177,1.175-31.023c4.52-9.845,12.606-17.342,22.766-21.107c10.159-3.765,21.176-3.348,31.023,1.174
                        c20.325,9.334,29.268,33.464,19.933,53.79l0,0C433.165,72.37,418.435,81.145,403.065,81.145z M403.138,18.106
                        c-2.635,0-5.274,0.469-7.819,1.411c-5.627,2.086-10.105,6.237-12.609,11.69c-2.504,5.454-2.736,11.557-0.65,17.184
                        S388.297,58.495,393.75,61c11.256,5.171,24.624,0.217,29.794-11.041l0,0c5.169-11.259,0.217-24.624-11.041-29.793
                        C409.515,18.796,406.331,18.106,403.138,18.106z M431.767,53.737h0.012H431.767z"/>
                    <path style="fill:#FCC447;" d="M284.133,456.309c-3.517,7.657-8.342,14.319-14.08,19.817c-18.71,17.91-47.17,23.604-72.143,12.135
                        c-24.973-11.469-39.202-36.766-37.808-62.628c0.432-7.936,2.339-15.936,5.856-23.595L284.133,456.309z"/>
                    <path style="fill:#F2B844;" d="M284.133,456.309c-3.517,7.657-8.342,14.319-14.08,19.817l-109.951-50.494
                        c0.432-7.936,2.339-15.936,5.856-23.595L284.133,456.309z"/>
                    <path style="fill:#F2B844;" d="M198.517,416.99l-32.558-14.952c-14.986,32.63-0.679,71.237,31.952,86.223
                        c5.648,2.594,11.478,4.291,17.331,5.186C193.777,475.027,186.126,443.972,198.517,416.99z"/>
                    <path style="fill:#FCC447;" d="M389.974,69.224c-78.145-35.888-169.326-4.377-218.533,102.771l-20.455,44.542
                        c-15.164,33.021-57.887,58.939-96.618,76.548c-25.741,11.703-25.906,48.172-0.21,59.973l169.682,77.925l169.682,77.924
                        c25.696,11.801,53.25-12.092,45.353-39.241c-11.883-40.852-20.065-90.148-4.899-123.17l20.455-44.542
                        C503.637,194.807,468.119,105.111,389.974,69.224z"/>
                    <path style="fill:#F2B844;" d="M108.632,318.006c38.731-17.608,81.454-43.528,96.618-76.548l20.455-44.542
                        c43.362-94.423,119.32-130.095,190.229-112.68c-8.008-5.719-16.679-10.749-25.96-15.011
                        c-78.145-35.889-169.326-4.378-218.532,102.77l-20.455,44.542c-15.164,33.02-57.887,58.939-96.618,76.548
                        c-25.741,11.703-25.906,48.172-0.21,59.973c0,0,24.171,11.1,54.264,24.92C82.726,366.178,82.892,329.708,108.632,318.006z"/>
                </svg>
            </span>
            <div class="inline-block align-middle mr-8" v-html="alertMsg">
            </div>
            <button @click="closeAlert()" class="absolute bg-transparent text-2xl font-semibold leading-none right-0 top-0 mt-4 mr-6 outline-none focus:outline-none">
            <span>×</span>
            </button>
            {% endverbatim %}
        </div>
    </div>
    <!-- 彈跳視窗 對話框 -->
    <div v-cloak :class="[ dialogBackgroundCss, dialogBackgroundStatus ]" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        {% verbatim %}
        <div class="flex flex-wrap justify-center content-center text-center sm:p-0 h-full p-3">
            <!-- 背景黑色 -->
            <div @click="vanishDialog(false)" class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
                aria-hidden="true"></div>

            <!-- 對話框實體 sm:align-middle sm:max-w-lg  -->
            <div class="inline-block align-bottom bg-white rounded-lg text-left shadow-xl transform transition-all
                        duration-75 sm:max-w-2xl sm:w-10/12 w-full max-h-full">
                <!-- 關閉叉叉按鈕 -->
                <div @click="vanishDialog(false)"
                    class="absolute right-0 w-8 h-8 flex flex-wrap justify-center content-center m-2 rounded-lg hover:bg-red-200 active:bg-blue-400 active:text-white transition-all duration-500">
                    <svg class="w-3 h-3" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg"
                        xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 512.001 512.001"
                        style="enable-background:new 0 0 512.001 512.001;" xml:space="preserve">
                        <g>
                            <path d="M284.286,256.002L506.143,34.144c7.811-7.811,7.811-20.475,0-28.285c-7.811-7.81-20.475-7.811-28.285,0L256,227.717
                                L34.143,5.859c-7.811-7.811-20.475-7.811-28.285,0c-7.81,7.811-7.811,20.475,0,28.285l221.857,221.857L5.858,477.859
                                c-7.811,7.811-7.811,20.475,0,28.285c3.905,3.905,9.024,5.857,14.143,5.857c5.119,0,10.237-1.952,14.143-5.857L256,284.287
                                l221.857,221.857c3.905,3.905,9.024,5.857,14.143,5.857s10.237-1.952,14.143-5.857c7.811-7.811,7.811-20.475,0-28.285
                                L284.286,256.002z" />
                        </g>
                    </svg>
                </div>
                <div class="bg-white pt-5 pb-4 sm:pb-4 flex flex-col h-full overflow-hidden rounded-lg">
                    <div class="px-4 py-5 sm:px-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">
                            Property Information
                        </h3>
                        <p class="mt-1 max-w-2xl text-sm text-gray-500">
                            Property details and links.
                        </p>
                    </div>
                    <div class="border-t border-gray-200 overflow-y-auto">
                        <div class="bg-gray-100 px-4 py-5 sm:gap-4 sm:px-6 relative">
                            <img class="mx-auto" :src="currentData.image" style="width: 70%;">
                        </div>
                        <div class="bg-gray-100 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                            <dt class="text-sm font-medium text-gray-500">
                                Full name
                            </dt>
                            <dd class="mt-1 text-xl text-gray-900 sm:mt-0 sm:col-span-2">
                                {{ currentData.product_name }}
                            </dd>
                        </div>
                        <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                            <dt class="text-sm font-medium text-gray-500">
                                Brand
                            </dt>
                            <dd class="mt-1 text-xl text-gray-900 sm:mt-0 sm:col-span-2">
                                {{ currentData.brand }}
                            </dd>
                        </div>
                        <div class="bg-gray-100 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                            <dt class="text-sm font-medium text-gray-500">
                                Number
                            </dt>
                            <dd class="mt-1 text-xl text-gray-900 sm:mt-0 sm:col-span-2">
                                {{ currentData.product_number }}-{{ currentData.number }}
                            </dd>
                        </div>
                        <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-6 sm:gap-4 sm:px-6">
                            <dt class="text-sm font-medium text-gray-500">
                                Position
                            </dt>
                            <dd class="mt-1 text-xl text-gray-900 sm:mt-0 sm:col-span-2">
                                {{ currentData.position }}
                            </dd>
                            <dt class="text-sm font-medium text-gray-500">
                                LabelPosition
                            </dt>
                            <dd class="mt-1 text-xl text-gray-900 sm:mt-0 sm:col-span-2">
                                {{ currentData.label_position }}
                            </dd>
                        </div>
                        <div class="bg-gray-100 px-4 py-5 sm:grid sm:grid-cols-6 sm:gap-4 sm:px-6">
                            <dt class="text-sm font-medium text-gray-500">
                                GetDate
                            </dt>
                            <dd class="mt-1 text-xl text-gray-900 sm:mt-0 sm:col-span-2">
                                {{ currentData.get_date }}
                            </dd>
                            <dt class="text-sm font-medium text-gray-500">
                                Expiry
                            </dt>
                            <dd class="mt-1 text-xl text-gray-900 sm:mt-0 sm:col-span-2">
                                {{ currentData.age_limit }}
                            </dd>
                        </div>
                        <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-6 sm:gap-4 sm:px-6">
                            <dt class="text-sm font-medium text-gray-500">
                                Price
                            </dt>
                            <dd class="mt-1 text-xl text-gray-900 sm:mt-0 sm:col-span-2">
                                ${{ currentData.single_value }}
                            </dd>
                            <dd class="mt-1 text-xl text-gray-900 sm:mt-0 sm:col-span-2">
                                {{ currentData.quantity }}/{{ currentData.unit }}
                            </dd>
                        </div>
                        <div class="bg-gray-100 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                            <dt class="text-sm font-medium text-gray-500">
                                Tips
                            </dt>
                            <dd class="mt-1 text-xl text-gray-900 sm:mt-0 sm:col-span-2">
                                {{ currentData.tip }}
                            </dd>
                        </div>
                        <div class="bg-gray-100 px-4 py-5 flex-row flex justify-center sm:px-6 gap-5">
                            <button @click="showRevise(true)" class="bg-white hover:bg-gray-100 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow">
                                修改資料
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endverbatim %}
    </div>
    <!-- 修改資訊 彈跳視窗 -->
    <div v-cloak :class="{'fixed z-20 inset-0 overflow-y-auto':true, 'hidden': !isReviseModel }" aria-labelledby="modal-title" role="dialog"
        aria-modal="true">
        <div class="flex flex-wrap justify-center content-center text-center sm:p-0 h-full p-3">
            <!-- 背景黑色 -->
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
                aria-hidden="true"></div>

            <!-- 對話框實體 sm:align-middle sm:max-w-lg  -->
            <div class="inline-block align-bottom bg-white rounded-lg text-left shadow-xl transform transition-all
                        duration-75 sm:max-w-2xl sm:w-10/12 w-full max-h-full">
                <!-- 關閉叉叉按鈕 -->
                <div @click="showRevise(false)"
                    class="absolute right-0 w-8 h-8 flex flex-wrap justify-center content-center m-2 rounded-lg hover:bg-red-200 active:bg-blue-400 active:text-white transition-all duration-500">
                    <svg class="w-3 h-3" version="1.1" xmlns="http://www.w3.org/2000/svg"
                        xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 512.001 512.001"
                        style="enable-background:new 0 0 512.001 512.001;" xml:space="preserve">
                        <g>
                            <path d="M284.286,256.002L506.143,34.144c7.811-7.811,7.811-20.475,0-28.285c-7.811-7.81-20.475-7.811-28.285,0L256,227.717
                                L34.143,5.859c-7.811-7.811-20.475-7.811-28.285,0c-7.81,7.811-7.811,20.475,0,28.285l221.857,221.857L5.858,477.859
                                c-7.811,7.811-7.811,20.475,0,28.285c3.905,3.905,9.024,5.857,14.143,5.857c5.119,0,10.237-1.952,14.143-5.857L256,284.287
                                l221.857,221.857c3.905,3.905,9.024,5.857,14.143,5.857s10.237-1.952,14.143-5.857c7.811-7.811,7.811-20.475,0-28.285
                                L284.286,256.002z" />
                        </g>
                    </svg>
                </div>
                <div class="bg-white pt-5 pb-4 sm:pb-4 flex flex-col h-full overflow-hidden rounded-lg">
                    <div class="px-4 sm:px-6 pb-5">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">
                            修改產品資料
                        </h3>
                    </div>
                    
                    <div class="border-t border-gray-200 overflow-y-auto">
                        {% verbatim %}
                        <dl>
                            <div class="relative bg-gray-100 px-4 py-5">
                                <div class="mx-auto" style="width: 70%;">
                                    <img :src="image" />
                                    <input type="file" class="absolute left-0 top-0 w-full h-full opacity-0"
                                           id="reviceImage" accept="image/gif, image/jpeg, image/png" @change="getImg($event)" >
                                </div>
                            </div>
                            <div class="bg-gray-100 px-4 py-3 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-gray-500">
                                    Full name
                                </dt>
                                <dd class="mt-1 text-xl text-gray-900 sm:mt-0 sm:col-span-2 relative">
                                    <input v-model="product_name" type="text" class="w-full">
                                </dd>
                            </div>
                            <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-gray-500">
                                    Brand
                                </dt>
                                <dd class="mt-1 text-xl text-gray-900 sm:mt-0 sm:col-span-2">
                                    <input v-model="brand" type="text" class="w-full" list="brandSelect">
                                    <datalist id="brandSelect">
                                        <option disabled selected>Choose</option>
                                            <option v-for="b in brandList">
                                                {{ b }}
                                            </option>
                                    </datalist>
                                </dd>
                            </div>
                            <div class="bg-gray-100 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-gray-500">
                                    Product number
                                </dt>
                                <dd class="mt-1 text-xl text-gray-900 sm:mt-0 sm:col-span-2">
                                    <input v-model="product_number" type="text" class="w-full">
                                </dd>
                            </div>
                            <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-gray-500">
                                    Serial
                                </dt>
                                <dd class="mt-1 text-xl text-gray-900 sm:mt-0 sm:col-span-2">
                                    <input v-model="number" type="text" class="w-full">
                                </dd>
                            </div>
                            <div class="bg-gray-100 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-gray-500">
                                    Position
                                </dt>
                                <dd class="mt-1 text-xl text-gray-900 sm:mt-0 sm:col-span-2">
                                    <input v-model="position" type="text" class="w-full" list="PositionSelect">
                                    <datalist id="PositionSelect">
                                        <option disabled selected>Choose</option>
                                            <option v-for="p in positionList">
                                                {{ p }}
                                            </option>
                                    </datalist>
                                </dd>
                            </div>
                            <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-gray-500">
                                    LabelPosition
                                </dt>
                                <dd class="mt-1 text-xl text-gray-900 sm:mt-0 sm:col-span-2">
                                    <input v-model="label_position" type="text" class="w-full" list="labelPositionSelect">
                                    <datalist id="labelPositionSelect">
                                        <option disabled selected>Choose</option>
                                            <option v-for="p in positionList">
                                                {{ p }}
                                            </option>
                                    </datalist>
                                </dd>
                            </div>
                            <div class="bg-gray-100 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-gray-500">
                                    GetDate
                                </dt>
                                <dd class="mt-1 text-xl text-gray-900 sm:mt-0 sm:col-span-2">
                                    <input v-model="get_date" type="date" class="w-full">
                                </dd>
                            </div>
                            <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-gray-500">
                                    Expiry
                                </dt>
                                <dd class="mt-1 text-xl text-gray-900 sm:mt-0 sm:col-span-2">
                                    <input v-model="age_limit" type="number" class="w-full">
                                </dd>
                            </div>
                            <div class="bg-gray-100 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-gray-500">
                                    Price
                                </dt>
                                <dd class="mt-1 text-xl text-gray-900 sm:mt-0 sm:col-span-2">
                                    <input v-model="single_value" type="number" class="w-full">
                                </dd>
                            </div>
                            <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-gray-500">
                                    quantity
                                </dt>
                                <dd class="mt-1 text-xl text-gray-900 sm:mt-0 sm:col-span-2">
                                    <input v-model="quantity" type="number" class="w-full">
                                </dd>
                            </div>
                            <div class="bg-gray-100 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-gray-500">
                                    unit
                                </dt>
                                <dd class="mt-1 text-xl text-gray-900 sm:mt-0 sm:col-span-2">
                                    <input v-model="unit" type="text" class="w-full" list="UnitSelect">
                                    <datalist id="UnitSelect">
                                        <option disabled selected>Choose</option>
                                            <option v-for="u in unitList">
                                                {{ u }}
                                            </option>
                                    </datalist>
                                </dd>
                            </div>
                            <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-gray-500">
                                    Tips
                                </dt>
                                <dd class="mt-1 text-xl text-gray-900 sm:mt-0 sm:col-span-2">
                                    <textarea v-model="tip" class="w-full"></textarea>
                                </dd>
                            </div>
                            <div class="bg-gray-100 px-4 py-5 flex-row flex justify-center sm:px-6 gap-5">
                                <button @click="showRevise(false)" class="bg-white hover:bg-gray-100 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow">
                                    取消
                                </button>
                                <button @click="updateData()" class="bg-white hover:bg-gray-100 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow">
                                    保存
                                </button>
                            </div>
                        </dl>
                        {% endverbatim %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 右鍵選單 -->
    <div v-cloak id="selectmenu" class="select-none cursor-pointer hidden origin-top-right fixed top-0 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5
     focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="options-menu">
        <div class="py-1" role="none">
            <a @click="vanishDialog(true)"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem">
                Detail(詳細資料)</a>
            <a @click="loanProperty()"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem">
                Rent(租借)</a>
            {% if user.is_staff %}
            <a @click="deleteData()" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900"
                role="menuitem">Delete(刪除)</a>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}


{% block javascript %}
{% load static %}
<script lang="javascript" src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<script src="{% static 'javaScripts/FileSaver.min.js' %}"></script>
<script>
    navbar.navbarMenuSearchCss = navbar.navbarMainMenuCss;

    const app = Vue.createApp({
        data() {
            return {
                // Restful API URL
                getData:            "{% url 'getData' %}",
                propertyDetail:     "{% url 'newpropertydetail' %}",
                deleteDataURL:      "{% url 'deleteData' %}",
                loanPropertyURL:    "{% url 'loanProperty' %}",
                getPositionUrl:     "{% url 'getPosition' %}",
                getBrandUrl:        "{% url 'getBrand' %}",
                getUnitUrl:         "{% url 'getUnit' %}",
                updateSingleDataUrl:"{% url 'updateSingleData' %}",

                propertyData: [],
                pagePropertyData: [],
                dialogBackgroundCss: "fixed z-10 inset-0 overflow-y-auto transition duration-300",
                dialogBackgroundStatus: "hidden",
                spinCircleStatus: "hidden",
                searchInput: "",
                currentData: "",

                // 當前排列
                nowSort: 0,
                loadFlag: false,

                // 當前頁數 、 總頁數 、 一頁幾筆
                now_page: 1,
                total_page: 1,
                num_one_page: 12,

                // 位置、品牌、單位列表
                positionList: [],
                brandList:    [],
                unitList:     [],

                // 通知CSS管理
                isAlertShow: false,
                isAlertHide: true,
                alertMsg: "",
                closeAlertTimer: "",
                alertColor: "bg-green-500",

                // 修改視窗
                isReviseModel: false,
                // 修改資料
                currentImage: "",
                sampleImage: "{% static 'images/uploadFile.jpg' %}",
                checkId: 0,
                age_limit: 0,
                brand: "",
                get_date: "",
                propId: 0,
                image: "",
                unit: "",
                label_position: "",
                number: "",
                position: "",
                product_name: "",
                product_number: "",
                quantity: 0,
                single_value: 0,
                tip: "",
            }
        },
        methods: {
            downloadExcel(){
                const result = R.map(
                    R.pipe(
                        R.dissoc('id'),
                        R.dissoc('image'),
                        R.ap(
                            R.flip(R.assoc('get_date')),
                            R.pipe(
                                R.prop('get_date'),
                                (strTime)=>{
                                    const ACTime = new Date(strTime)
                                    ACTime.setFullYear(ACTime.getFullYear() - 1911)
                                    const ROCyear = ACTime.getFullYear().toString().padStart(3, '0')
                                    const ROCmonth = (ACTime.getMonth() + 1).toString().padStart(2, '0')
                                    const ROCdate = ACTime.getDate().toString().padStart(2, '0')
                                    return `${ROCyear}${ROCmonth}${ROCdate}`
                                }
                            )
                        )
                    ),
                    this.propertyData
                )
                const worksheet = XLSX.utils.json_to_sheet(result)
                const workbook = XLSX.utils.book_new()
                XLSX.utils.book_append_sheet(workbook, worksheet, "Dates")
                const fixHeader = [
                    ["機關名稱", "國立勤益科技大學", "", "盤點代碼", `${new Date().getFullYear()-1911}${new Date().getMonth().toString().padStart(2,"0")}`, "", "", "", "", "", "", "", "", "", ""],
                    ["盤點狀態", "財產名稱", "序號", "財產編號", "備註", "取得日期", "年限", "數量", "單價", "實際地點", "廠牌型式", "存置地點", "單位", "租借狀態"]
                ];
                XLSX.utils.sheet_add_aoa(worksheet, fixHeader, { origin: "A1" });
                const wopts = { bookType:'xlsx', bookSST:false, type:'binary' }
                const wbout = XLSX.write(workbook,wopts)
                function s2ab(s) {
                    var buf = new ArrayBuffer(s.length)
                    var view = new Uint8Array(buf)
                    for (var i=0; i!=s.length; ++i) view[i] = s.charCodeAt(i) & 0xFF
                    return buf
                }
                saveAs(new Blob([s2ab(wbout)],{type:""}), "財產詳細訊息.xlsx")
            },
            // 取得上傳圖片
            getImg(e){
                let files = e.target.files;
                if(files.length == 0)
                    return;
                var reader = new FileReader();
                let self = this;
                reader.onload = (e) => {
                    self.image = e.target.result;
                }
                reader.readAsDataURL(files[0]);
                this.currentImage = files[0];
            },
            // 讀取Cookie
            readCookie(name) {
                var nameEQ = name + "=";
                return R.defaultTo(null)(R.find(
                    R.pipe( R.equals(undefined), R.not),
                    R.map(
                        R.ifElse(
                                R.pipe(R.indexOf(nameEQ), R.equals(-1), R.not),
                                R.ap(
                                    R.flip(R.takeLast),
                                    R.pipe(R.length, R.flip(R.subtract)(nameEQ.length+1))
                                ),
                                R.always(undefined)
                            ),
                        R.split(';', document.cookie)
                    )
                ))
            },
            async Load(numPage, isReLoad=false) {
                if(this.loadFlag)
                    return;

                this.loadFlag = true;

                if(isReLoad){
                    this.switchSpinCircle();
                }

                // 提取URL參數存成變數
                let uri = window.location.search.substring(1);
                let params = new URLSearchParams(uri);
                page = params.get("page");
                search = params.get("search");
                this.searchInput = search;


                
                var queryParams = new URLSearchParams(window.location.search);
                // 檢查頁碼
                if (page == NaN || page == undefined) {
                    this.pagePropertyData = []
                    queryParams.set("page", numPage);
                    this.now_page = numPage;
                }
                else if (numPage != NaN && numPage != undefined) {
                    page = numPage;
                    this.pagePropertyData = []
                    queryParams.set("page", page);
                    this.now_page = page;
                }
                history.replaceState(null, null, "?" + queryParams.toString());

                

                //////////////////////////////////////////////////////
                if(isReLoad){
                    let response =  await axios.get(this.getData, {
                        params: {
                            "search": search,
                        },
                    });

                    // 接收完整資料
                    this.propertyData = response.data.data;
                    
                    this.sortProperty();

                    // 計算總共有幾頁
                    this.total_page = parseInt(this.propertyData.length / this.num_one_page) + 1;

                    // 檢查頁碼有無錯誤
                    try {
                        page = parseInt(page);
                        if (isNaN(page) || page < 1) {
                            this.now_page = 1;
                        } else if (page > this.total_page) {
                            this.now_page = this.total_page;
                        } else {
                            this.now_page = page;
                        }
                    } catch (error) {
                        this.now_page = 1;
                    }
                }
                //////////////////////////////////////////////////////

                // 初始化
                this.pagePropertyData = []
                // 頁面當前陣列資料
                for (i = (this.now_page - 1) * this.num_one_page, o = 0; i < this.now_page * this.num_one_page && i < this.propertyData.length; i++, o++)
                    this.pagePropertyData[o] = this.propertyData[i]

                if(isReLoad){
                    this.switchSpinCircle();
                }
                
                this.loadFlag = false;
            },
            // 重整頁面，會與伺服器重新要求資料
            reLoad(numPage) {
                this.switchSpinCircle();
                let uri = window.location.search.substring(1);
                let params = new URLSearchParams(uri);
                page = params.get("page");
                search = params.get("search");
                this.searchInput = search;

                if (numPage != NaN && numPage != undefined) {
                    page = numPage;
                    this.pagePropertyData = []
                    var queryParams = new URLSearchParams(window.location.search);
                    queryParams.set("page", page);
                    history.replaceState(null, null, "?" + queryParams.toString());
                }

                var self = this;
                axios.get(this.getData, {
                    params: {
                        "search": search,
                    },
                })
                    .then(function (response) {
                        // 接收完整資料
                        self.propertyData = response.data.data;
                        // 計算總共有幾頁
                        self.total_page = parseInt(self.propertyData.length / self.num_one_page) + 1;

                        // 檢查頁碼有無錯誤
                        try {
                            page = parseInt(page);
                            if (isNaN(page) || page < 1) {
                                self.now_page = 1;
                            } else if (page > self.total_page) {
                                self.now_page = self.total_page;
                            } else {
                                self.now_page = page;
                            }
                        } catch (error) {
                            self.now_page = 1;
                        }

                        // 初始化
                        self.pagePropertyData = []
                        // 頁面當前陣列資料
                        for (i = (self.now_page - 1) * self.num_one_page, o = 0; i < self.now_page * self.num_one_page && i < self.propertyData.length; i++, o++)
                            self.pagePropertyData[o] = self.propertyData[i]
                    })
                    .catch(function (error) {
                        // handle error
                        console.log(error);
                    })
                    .then(function () {
                        // always executed
                        self.switchSpinCircle();
                        init()
                    });

            },
            /*
            # 通知部分
            # 彈跳通知
            */
            // 顯示通知
            showAlert(msg, bgColor = "bg-green-500", duration = 3000){
                this.alertColor = bgColor;
                this.alertMsg = msg;
                this.isAlertShow = true;
                this.isAlertHide = false;
                let self = this;
                clearTimeout(this.closeAlertTimer);
                this.closeAlertTimer = setTimeout(()=>{self.closeAlert()}, duration);
            },
            // 關閉提醒
            closeAlert(){
                this.isAlertShow = false;
                let self = this;
                setTimeout(()=>{
                    self.isAlertHide = true;
                }, 500);
            },
            // 使對話框改變
            vanishDialog(isShow){
                R.ifElse(                
                    R.identity,
                    (x)=>{
                        this.dialogBackgroundStatus = "";
                        this.dialogBackgroundStatus = "opacity-100";
                    },
                    (x)=>{
                        this.dialogBackgroundStatus = "opacity-0";
                        setTimeout(() => {
                            this.dialogBackgroundStatus = "hidden";
                        }, 300)
                    }
                )(isShow)
            },
            // 使消失加載畫面
            switchSpinCircle() {
                if (this.spinCircleStatus == "hidden")
                    this.spinCircleStatus = "show";
                else
                    this.spinCircleStatus = "hidden";
            },
            // 動態更新畫面(不重新要求資料)，但會更改上方URL參數
            changePage(numPage) {
                if (numPage < 1 || isNaN(numPage))
                    numPage = 1;
                else if (numPage > this.total_page)
                    numPage = this.total_page;

                this.now_page = numPage;

                this.pagePropertyData = []
                // 頁面當前陣列資料
                for (i = (this.now_page - 1) * this.num_one_page, o = 0; i < this.now_page * this.num_one_page && i < this.propertyData.length; i++, o++)
                    this.pagePropertyData[o] = this.propertyData[i];

                // Construct URLSearchParams object instance from current URL querystring.
                var queryParams = new URLSearchParams(window.location.search);
                // Set new or modify existing parameter value. 
                queryParams.set("page", this.now_page);
                // Replace current querystring with the new one.
                history.replaceState(null, null, "?" + queryParams.toString());
            },
            // 搜尋
            search() {
                window.location.href = location.protocol + '//' + location.host + location.pathname + "?page=1&search=" + this.searchInput;
            },
            // 刪除一項產品
            deleteData() {
                var result = confirm("確認刪除?");
                if (!result) {
                    return 0;
                }
                let self = this;
                axios.get(this.deleteDataURL, {
                    params: {
                        "id": self.currentData.id,
                    },
                })
                    .then(function (response) {
                        alert(response.data.result);
                        self.reLoad(self.now_page);
                        mySocket.send(JSON.stringify({"action": "newNotify"}));
                    })
                    .catch(function (error) {
                    })
                    .then(function () {
                    })
            },
            // 租借一項物品
            loanProperty(){
                var result = confirm("確認租借?");
                if (!result) {
                    return 0;
                }
                let self = this;
                axios.get(this.loanPropertyURL,{
                            params: {
                                "id": self.currentData.id,
                            },
                        })
                        .then(function (response){
                            if(response.data.result == 'success'){
                                alert("成功預約，請等管理員同意");
                                mySocket.send(JSON.stringify({"action": "getRecentNotify"}));
                                mySocket.send(JSON.stringify({"action": "newNotify"}));
                            }else if(response.data.result == 'empty'){
                                alert("序號以及編號有錯，聯絡管理員");
                            }else if(response.data.result == 'loaning'){
                                alert("物品於租借中");
                            }else if(response.data.result == 'duplicate'){
                                alert("預約重複");
                            }else if(response.data.result == 'permission_deny'){
                                alert("您沒有權限");
                            }else{

                            }
                        })
                        .catch(function (error) {

                        })
                        .then(function () {

                        })
            },
            // 重新導向到詳細資料
            href(sd) {
                window.location = this.propertyDetail + '?id=' + sd.id;
            },
            // 取得右鍵所選物品
            contextmenu(e, property) {
                this.currentData = property;
                var y = e.clientY;
                var x = e.clientX;

                $("#selectmenu").css("left", x);
                $("#selectmenu").css("top", y);
                $("#selectmenu").css("display", "block");
            },
            // 隱藏右鍵選單(左鍵點擊時、滾輪滾動時)
            hideContextMenu(e){
                $('#selectmenu').css('display', 'none');
            },
            // 計算總共有幾頁
            pagesRange(){
                pages = []

                if(!this.loadFlag){
                    nowPage = this.now_page

                    if(nowPage-2 > 0) pages.push(nowPage-2);
                    if(nowPage-1 > 0) pages.push(nowPage-1);
                    pages.push(nowPage);
                    if(nowPage+1 < this.total_page) pages.push(nowPage+1);
                    if(nowPage+2 < this.total_page) pages.push(nowPage+2);
                }

                return pages
            },
            // 手機板更改畫面
            phoneChangePage(e){
                this.changePage(e.target.options.selectedIndex+1)
            },
            // 排序產品
            sortProperty(isReverse = false){
                // 1 按照 名稱 排序
                function nameCompare( a, b ) {
                    if ( a.product_name > b.product_name ) return -1;
                    if ( a.product_name < b.product_name ) return 1;
                    return 0;
                }
                // 2 按照 盤點 排序
                function checkCompare( a, b ) {
                    if ( a.is_check == 'v' ) return -1;
                    if ( b.is_check == 'v' ) return 1;
                    return 0;
                }
                // 3 按照 產品編號 排序
                function productNumberCompare( a, b ) {
                    if ( a.product_number > b.product_number ) return -1;
                    else if ( a.product_number < b.product_number ) return 1;
                    if ( a.number > b.number ) return -1;
                    else if ( a.number < b.number ) return 1;
                    return 0;
                }
                // 4 按照 序號 排序
                function numberCompare( a, b ) {
                    if ( a.number > b.number ) return -1;
                    if ( a.number < b.number ) return 1;
                    return 0;
                }
                // 5 按照 位置 排序
                function positionCompare( a, b ) {
                    if ( a.position > b.position ) return -1;
                    if ( a.position < b.position ) return 1;
                    return 0;
                }
                // 6 按照 產貼位置 排序
                function labelPositionCompare( a, b ) {
                    if ( a.label_position > b.label_position ) return -1;
                    if ( a.label_position < b.label_position ) return 1;
                    return 0;
                }
                // 7 按照 產貼位置 排序
                function labelPositionCompare( a, b ) {
                    if ( a.label_position > b.label_position ) return -1;
                    if ( a.label_position < b.label_position ) return 1;
                    return 0;
                }
                // 8 按照 取得日期 排序
                function getDateCompare( a, b ){
                    if ( a.get_date > b.get_date ) return -1;
                    if ( a.get_date < b.get_date ) return 1;
                    return 0;
                }
                // 9 按照 價格 排序
                function priceCompare( a, b ){
                    if ( a.single_value > b.single_value ) return -1;
                    if ( a.single_value < b.single_value ) return 1;
                    return 0;
                }

                let mode = 1;
                try{
                    mode = parseInt(this.nowSort);
                }catch{
                    return;
                }
                // 選取排序模式
                switch(mode){
                    case 1:
                        console.log("按照名稱排序");
                        this.propertyData.sort(nameCompare);
                        break;
                    case 2:
                        console.log("按照盤點排序");
                        this.propertyData.sort(checkCompare);
                        break;
                    case 3:
                        console.log("按照編號排序");
                        this.propertyData.sort(productNumberCompare);
                        break;
                    case 4:
                        console.log("按照序號排序");
                        this.propertyData.sort(numberCompare);
                        break;
                    case 5:
                        console.log("按照真實位置排序");
                        this.propertyData.sort(positionCompare);
                        break;
                    case 6:
                        console.log("按照產貼邊號排序");
                        this.propertyData.sort(labelPositionCompare);
                        break;
                    case 7:
                        console.log("按照取得日期排序");
                        this.propertyData.sort(getDateCompare);
                        break;
                    case 8:
                        console.log("按照取得價格排序");
                        this.propertyData.sort(priceCompare);
                        break;
                }
                
                if(isReverse)
                    this.propertyData.reverse();

                // 初始化
                this.pagePropertyData = []
                // 頁面當前陣列資料
                for (i = (this.now_page - 1) * this.num_one_page, o = 0; i < this.now_page * this.num_one_page && i < this.propertyData.length; i++, o++)
                    this.pagePropertyData[o] = this.propertyData[i]
            },
            // 顯示修改視窗
            showRevise(status){
                this.isReviseModel = status;
                document.getElementById("reviceImage").value = "";
                if(status == true){
                    this.image = this.sampleImage;
                    this.product_name = this.currentData.product_name;
                    this.brand = this.currentData.brand;
                    this.product_number = this.currentData.product_number;
                    this.get_date = this.currentData.get_date;
                    this.propId = this.currentData.id;
                    this.checkId = this.currentData.id;
                    this.label_position = this.currentData.label_position;
                    this.number = this.currentData.number;
                    this.position = this.currentData.position;
                    this.unit = this.currentData.unit;
                    this.quantity = this.currentData.quantity;
                    this.single_value = this.currentData.single_value;
                    this.tip = this.currentData.tip;
                }
            },
            // 更新資料
            updateData(){
                const data = {
                    file: this.currentImage,
                    name: this.product_name,
                    checkId: this.checkId,
                    propId: this.propId,
                    brand: this.brand,
                    number: this.product_number,
                    serial: this.number,
                    position: this.label_position,
                    realPosition: this.position,
                    getDate: this.get_date,
                    expireDate: this.age_limit,
                    amount: this.quantity,
                    price: this.single_value,
                    tips: this.tip,
                    unit: this.unit
                }
                const myformData = new FormData();
                R.map(
                    (x)=>{
                        myformData.append(x, R.prop(x, data));
                    },
                    R.keys(data)
                )

                axios({
                    method: "post",
                    url: this.updateSingleDataUrl,
                    headers: { 
                        'X-CSRFToken': this.readCookie('csrftoken'),
                        "Content-Type": "multipart/form-data",
                        },
                    data: myformData,
                })
                .then((res)=>{
                    result = res.data.result;
                    // 成功則顯示成功，然後退出
                    if(result != "failed"){
                        this.showAlert(result);
                        this.showRevise(false);
                        this.syncData();
                    }else{
                        if(res.data.reason == "Duplicated"){
                            this.showAlert("序號重複", "bg-red-500");
                            mySocket.send({"action": "newNotify"});
                        }
                    }
                })
                .catch((err)=>{
                    alert(`Server response ${err.response.status}.`)
                })
                .final(()=>{
                    document.getElementById("reviceImage").value = "";
                })
            },
            // 同步更新用戶端資料
            syncData(){
                this.currentData.image = this.image;
                this.currentData.product_name = this.product_name;
                this.currentData.brand = this.brand;
                this.currentData.product_number = this.product_number;
                this.currentData.get_date = this.get_date;
                this.currentData.label_position = this.label_position;
                this.currentData.number = this.number;
                this.currentData.position = this.position;
                this.currentData.unit = this.unit;
                this.currentData.quantity = this.quantity;
                this.currentData.single_value = this.single_value;
                this.currentData.tip = this.tip;
            }
        },
        mounted() {
            window.addEventListener('click', this.hideContextMenu);
            window.addEventListener('scroll', this.hideContextMenu, true);
            let self = this;
            axios.get(this.getPositionUrl)
            .then((res)=>{self.positionList = res.data.position});
            axios.get(this.getBrandUrl)
            .then((res)=>{self.brandList = res.data.brand});
            axios.get(this.getUnitUrl)
            .then((res)=>{self.unitList = res.data.unit});
        },
        created() {
            this.Load(undefined,true);
        },
    }).mount('#itemCard');
</script>
{% endblock %}