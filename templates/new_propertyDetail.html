{% extends 'new_Template.html' %}
{% block title %}
    <title>Detail</title>
{% endblock %}


{# 此部分為css #}
{% block style %}
<style>
    [v-cloak]{
        display: none;
    }
</style>
{% endblock %}



{% block content %}
<div id="app">
    <!-- 詳細資料與圖片 -->
    <div v-cloak class="container px-5 py-24 mx-auto flex flex-wrap">
        {% verbatim %}
        <!-- 左邊圖片 -->
        <div class="lg:w-1/2 w-full mx-auto mb-10 lg:mb-0 rounded-lg overflow-hidden max-h-screen">
            <img @click="previewImage(true)" alt="feature" class="object-cover object-center h-full w-full" :src="data.image">
        </div>
        <!-- 右邊詳細訊息 -->
        <div class="flex flex-col flex-wrap lg:py-6 -mb-10 lg:w-1/2 lg:pl-12 lg:text-left w-full text-center">
            <!-- 顯示產品名稱 -->
            <div class="lg:items-start items-center mb-5">
                <div class="w-2/3 inline-block">
                    <h2 class="text-gray-900 text-lg title-font font-medium">產品名稱
                        <h1 class="text-gray-900 text-2xl title-font font-bold">{{ data.product_name }}</h1>
                    </h2>
                </div>
                <div class="w-1/3 inline-block">
                    <a :href="'https://www.google.com/search?q=' + data.product_name" target="_blank"
                    class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm
                            font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2
                            focus:ring-offset-2 focus:ring-indigo-500">
                        搜尋名稱
                    </a>
                </div>
            </div>
            <!-- 品牌 -->
            <div class="lg:items-start items-center mb-5">
                <div class="w-2/3 inline-block">
                    <h2 class="text-gray-900 text-lg title-font font-medium">品牌
                        <h1 class="text-gray-900 text-2xl title-font font-bold">{{ data.brand }}</h1>
                    </h2>
                </div>
                <div class="w-1/3 inline-block">
                    <a :href="'https://www.google.com/search?q=' + data.brand" target="_blank"
                    class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm
                            font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2
                            focus:ring-offset-2 focus:ring-indigo-500">
                        搜尋品牌
                    </a>
                </div>
            </div>
            <!-- 序號 以及 產品編號 -->
            <div class="lg:items-start items-center mb-5">
                <div class="w-1/2 inline-block">
                    <h2 class="text-gray-900 text-lg title-font font-medium">序號
                        <h1 class="text-gray-900 text-2xl title-font font-bold">{{ data.property_number }}</h1>
                    </h2>
                </div>
                <div class="w-1/2 inline-block">
                    <h2 class="text-gray-900 text-lg title-font font-medium">產品編號
                        <h1 class="text-gray-900 text-2xl title-font font-bold">{{ data.serial_number }}</h1>
                    </h2>
                </div>
            </div>
            <!-- 實際位置 以及 產貼上位置 -->
            <div class="lg:items-start items-center">
                <div class="w-1/2 inline-block">
                    <h2 class="text-gray-900 text-lg title-font font-medium">實際位置
                        <h1 class="text-gray-900 text-2xl title-font font-bold">{{ data.position }}</h1>
                    </h2>
                </div>
                <div class="w-1/2 inline-block">
                    <h2 class="text-gray-900 text-lg title-font font-medium">產貼上位置
                        <h1 class="text-gray-900 text-2xl title-font font-bold">{{ data.label_position }}</h1>
                    </h2>
                </div>
            </div>
            <!-- 取得日期 以及 年限 -->
            <div class="lg:items-start items-center">
                <div class="w-1/2 inline-block">
                    <h2 class="text-gray-900 text-lg title-font font-medium">取得日期
                        <h1 class="text-gray-900 text-2xl title-font font-bold">{{ data.get_date }}</h1>
                    </h2>
                </div>
                <div class="w-1/2 inline-block">
                    <h2 class="text-gray-900 text-lg title-font font-medium">年限
                        <h1 class="text-gray-900 text-2xl title-font font-bold">{{ data.expiry_date }} year(s)</h1>
                    </h2>
                </div>
            </div>
            <!-- 取得日期 以及 年限 -->
            <div class="lg:items-start items-center mb-5">
                <div class="w-1/2 inline-block">
                    <h2 class="text-gray-900 text-lg title-font font-medium">數量
                        <h1 class="text-gray-900 text-2xl title-font font-bold">{{ data.quantity }} /{{ data.unit }}</h1>
                    </h2>
                </div>
                <div class="w-1/2 inline-block">
                    <h2 class="text-gray-900 text-lg title-font font-medium">價格
                        <h1 class="text-gray-900 text-2xl title-font font-bold">${{ data.price }}</h1>
                    </h2>
                </div>
            </div>
            <!-- 品牌 -->
            <div class="lg:items-start items-center mb-5">
                <div class="w-full inline-block">
                    <h2 class="text-gray-900 text-lg title-font font-medium">備註
                        <h1 class="text-gray-900 text-2xl title-font font-bold">{{ data.tip }}</h1>
                    </h2>
                </div>
            </div>
            {% endverbatim %}
            <!-- 功能按鈕 -->
            <div class="lg:items-start items-center">
                <div class="w-1/3 inline-block">
                    <a onclick="window.history.go(-1)">
                        <button class="group relative w-1/2 mx-auto flex justify-center py-2 px-4 border border-transparent text-sm
                                                    font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2
                                                    focus:ring-offset-2 focus:ring-indigo-500">
                            返回搜尋
                        </button>
                    </a>
                </div>
                <div class="w-1/3 inline-block">
                    <a @click="loanProperty()">
                        <button class="group relative w-1/2 mx-auto flex justify-center py-2 px-4 border border-transparent text-sm
                                                        font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2
                                                        focus:ring-offset-2 focus:ring-indigo-500">
                                租借這項物品
                        </button>
                    </a>
                </div>
                {% if user.is_staff %}
                <div class="w-1/3 inline-block">
                    <a @click="toEditPage({% url 'admin:index' %})">
                        <button class="group relative w-1/2 mx-auto flex justify-center py-2 px-4 border border-transparent text-sm
                                                    font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2
                                                    focus:ring-offset-2 focus:ring-indigo-500">
                            編輯
                        </button>
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    <!-- 預覽圖片視窗 -->
    <div v-cloak :class="'fixed z-10 inset-0 overflow-y-auto transition duration-300 ' + previewStatus" aria-labelledby="modal-title" role="dialog"
        aria-modal="true">
        <div class="flex flex-wrap justify-center content-center text-center sm:p-0 h-full p-3">
            <!-- 背景黑色 -->
            <div @click="previewImage(false)" class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"
                aria-hidden="true"></div>

            <!-- 圖片顯示  -->
            <div class="inline-block align-bottom transform max-w-full max-h-full md:p-10 p-3">
                <div class="bg-white rounded-lg p-1 relative">
                    <div class="absolute right-5 top-5 hover:bg-gray-50 p-2 rounded-full" @click="previewImage(false)">
                        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="15px" height="15px"
	                        viewBox="0 0 512.001 512.001" style="enable-background:new 0 0 512.001 512.001;" xml:space="preserve">
                            <path d="M284.286,256.002L506.143,34.144c7.811-7.811,7.811-20.475,0-28.285c-7.811-7.81-20.475-7.811-28.285,0L256,227.717
                                    L34.143,5.859c-7.811-7.811-20.475-7.811-28.285,0c-7.81,7.811-7.811,20.475,0,28.285l221.857,221.857L5.858,477.859
                                    c-7.811,7.811-7.811,20.475,0,28.285c3.905,3.905,9.024,5.857,14.143,5.857c5.119,0,10.237-1.952,14.143-5.857L256,284.287
                                    l221.857,221.857c3.905,3.905,9.024,5.857,14.143,5.857s10.237-1.952,14.143-5.857c7.811-7.811,7.811-20.475,0-28.285
                                    L284.286,256.002z"/>
                        </svg>
                    </div>
                    <img :src="data.image">
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}


{% block javascript %}
<script>
    const app = Vue.createApp({
        data() {
            return {
                // Restful API URL
                getSingleData: "{% url 'getSingleData' %}",
                loanPropertyURL: "{% url 'loanProperty' %}",
                data:{
                    image : "https://i.imgur.com/3ZTDX.jpeg",
                },
                previewStatus: "hidden",
            }
        },
        methods:{
            toEditPage(url){
                url += 'index/property/' + this.data.id + '/change/';
                window.open(url,'_blank');
            },
            loanProperty(){
                axios.get(this.loanPropertyURL,{
                            params:{
                                'id': this.data.id,
                            },
                        })
                        .then(function (response){
                            if(response.data.result == 'success'){
                                alert("成功預約，請等管理員同意");
                            }else if(response.data.result == 'empty'){
                                alert("序號以及編號有錯，聯絡管理員");
                            }else if(response.data.result == 'loaning'){
                                alert("物品於租借中");
                            }else if(response.data.result == 'duplicate'){
                                alert("預約重複");
                            }else if(response.data.result == 'permission_deny'){
                                alert("您沒有權限");
                            }else{

                            }
                        })
                        .catch(function (error) {

                        })
                        .then(function () {

                        })
            },
            previewImage(status){
                if(status)
                    this.previewStatus = "";
                else
                    this.previewStatus = "hidden";
            },
        },
        mounted(){
        },
        created(){
            // 取得網頁上方GET參數
            let uri = window.location.search.substring(1); 
            let params = new URLSearchParams(uri);
            id = params.get("id");

            // 從後台獲取產品資訊
            var self = this;
            axios.get(this.getSingleData,{
                    params:{
                        "id": id,
                    }
                }).then(function (response) {
                    // handle success
                    if(response.data.result == 'success')
                        self.data = response.data.data;
                }).catch(function (error) {
                    // handle error
                    console.log(error);
                }).then(function () {
                    // always executed
                });
        },
    }).mount('#app');

</script>
{% endblock %}